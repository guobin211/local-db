## 新增需求

### 需求：自动 CHANGELOG 生成

系统必须提供自动从 Git 提交历史生成 CHANGELOG.md 文件的能力。

#### 场景：从 Git 历史生成 CHANGELOG
- **当** 开发者运行 `pnpm changelog` 命令
- **那么** 系统应读取 Git 提交历史
- **并且** 按提交类型（feat、fix、chore 等）分类变更
- **并且** 按版本标签分组变更记录
- **并且** 生成或更新 CHANGELOG.md 文件

#### 场景：预览生成内容而不写入文件
- **当** 开发者运行 `pnpm changelog:preview` 命令
- **那么** 系统应在控制台输出生成的 CHANGELOG 内容
- **但是** 不应修改或创建 CHANGELOG.md 文件

#### 场景：增量更新现有 CHANGELOG
- **当** CHANGELOG.md 文件已存在
- **并且** 开发者运行 `pnpm changelog` 命令
- **那么** 系统应保留现有的版本记录
- **并且** 仅添加尚未记录的新版本变更
- **并且** 将新内容插入到文件顶部（[Unreleased] 部分之后）

#### 场景：完全重写 CHANGELOG
- **当** 开发者运行 `pnpm changelog --overwrite` 命令
- **那么** 系统应从头生成完整的 CHANGELOG.md
- **并且** 覆盖现有文件内容

### 需求：提交信息分类

系统必须能够识别和分类不同类型的 Git 提交信息。

#### 场景：识别功能类提交
- **当** 提交信息以 `feat:` 或 `feat(scope):` 开头
- **那么** 系统应将该提交归类为"新增功能"（Added）类别

#### 场景：识别修复类提交
- **当** 提交信息以 `fix:` 或 `fix(scope):` 开头
- **那么** 系统应将该提交归类为"修复"（Fixed）类别

#### 场景：识别其他类型提交
- **当** 提交信息以 `chore:`、`docs:`、`refactor:`、`perf:`、`style:` 或 `test:` 开头
- **那么** 系统应按照预定义的映射规则将其归类到对应类别
- **并且** 映射规则应为：
  - `refactor:` → Changed（变更）
  - `perf:` → Changed（变更）
  - `docs:` → Documentation（文档）
  - `chore:` → Maintenance（维护）
  - `test:` → Testing（测试）
  - `style:` → Changed（变更）

#### 场景：处理不符合规范的提交
- **当** 提交信息不包含标准类型前缀
- **那么** 系统应将该提交归类为"其他变更"（Changed）类别
- **或者** 在文档中建议手动调整该条目

### 需求：版本识别和分组

系统必须能够识别 Git 标签并按版本分组变更记录。

#### 场景：识别版本标签
- **当** Git 仓库中存在符合语义化版本的标签（如 v1.0.0、1.2.3）
- **那么** 系统应识别这些标签作为版本号
- **并且** 提取标签的创建日期作为发布日期

#### 场景：分组版本变更
- **当** 生成 CHANGELOG 时
- **那么** 系统应将每个版本标签之间的提交分组到对应版本下
- **并且** 未打标签的最新提交应归入 [Unreleased] 部分

#### 场景：处理无标签的仓库
- **当** Git 仓库中没有任何版本标签
- **那么** 系统应将所有提交归入 [Unreleased] 部分

### 需求：Keep a Changelog 格式输出

系统生成的 CHANGELOG.md 必须符合 Keep a Changelog 1.0.0 标准。

#### 场景：生成标准 CHANGELOG 结构
- **当** 生成 CHANGELOG.md 文件时
- **那么** 文件应包含以下结构：
  - 文件标题："# Changelog"
  - 格式说明段落（引用 Keep a Changelog 和 Semantic Versioning）
  - [Unreleased] 部分（如有未发布的提交）
  - 各版本部分（按时间倒序排列）

#### 场景：格式化版本部分
- **当** 输出某个版本的变更时
- **那么** 版本标题应使用格式：`## [版本号] - YYYY-MM-DD`
- **并且** 变更内容应按类型分组，使用三级标题（### Added、### Fixed 等）
- **并且** 每个变更项使用列表格式（`- 变更描述`）

#### 场景：使用中文类型标题
- **当** 生成 CHANGELOG 时
- **那么** 类型标题应使用中文：
  - Added → "### 新增功能"
  - Fixed → "### 修复"
  - Changed → "### 变更"
  - Documentation → "### 文档"
  - Maintenance → "### 维护"
  - Testing → "### 测试"

### 需求：跨平台兼容性

CHANGELOG 生成脚本必须在 macOS、Linux 和 Windows 平台上正常运行。

#### 场景：在不同操作系统上执行
- **当** 在 macOS、Linux 或 Windows 系统上运行 `pnpm changelog`
- **那么** 脚本应成功执行并生成 CHANGELOG.md
- **并且** 不应出现平台特定的错误或兼容性问题

#### 场景：处理文件路径
- **当** 脚本读取或写入文件时
- **那么** 应使用 Node.js 的 `path` 模块处理路径
- **并且** 确保路径分隔符在所有平台上正确

### 需求：错误处理和用户反馈

系统必须提供清晰的错误信息和执行反馈。

#### 场景：检测 Git 仓库
- **当** 在非 Git 仓库目录中运行脚本
- **那么** 系统应显示错误信息："当前目录不是 Git 仓库"
- **并且** 退出脚本执行

#### 场景：显示执行进度
- **当** 脚本正在处理 Git 历史时
- **那么** 应在控制台显示进度信息（如"正在读取提交历史..."）
- **并且** 完成后显示成功信息（如"CHANGELOG.md 已生成"）

#### 场景：处理写入权限错误
- **当** 无法写入 CHANGELOG.md 文件（如权限不足）
- **那么** 系统应显示清晰的错误信息
- **并且** 建议用户检查文件权限

### 需求：配置和可扩展性

系统必须支持基本的配置选项以适应不同需求。

#### 场景：通过命令行选项控制行为
- **当** 开发者运行 `pnpm changelog --dry-run`
- **那么** 系统应预览输出而不写入文件
- **当** 开发者运行 `pnpm changelog --overwrite`
- **那么** 系统应完全重写 CHANGELOG.md

#### 场景：自定义输出文件路径（可选）
- **当** 开发者运行 `pnpm changelog --output=docs/CHANGELOG.md`
- **那么** 系统应将 CHANGELOG 生成到指定路径
- **注**：此为可选功能，初期可不实现
